<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="vendor/filesaver.js"></script>
</head>
<body>
	<input type='text' id='playerId' value=''><br>
	<input type='button' onClick='process()' value='go'>
	<script>
	function process() {
		var id = document.getElementById('playerId').value;
		$.getJSON("taster-2-gameData29-01-2016.json", function(obj) {
			var games = [];
			for (var result in obj.results) { // get all results for the id
				if (obj.results[result].playerId === id) {
					games.push(obj.results[result]);
				}
			}
			console.log('Found ' + games.length + ' games for player ' + id);
			// sort by time created
			games.sort(function(game1, game2){
				var date1 = new Date(game1.createdAt);
				var date2 = new Date(game2.createdAt);
				return new Date(date1) - new Date(date2);
			});
			// build a csv file
			var csv = 'Game,Wave,Total number of creatures,Percentage targets,Uniformity,Success rate\n';
			for (var game in games) {
				var waves = JSON.parse(games[game].waves);
				for (var wave in waves) {
					var settings = waves[wave].difficultySetting.split(':');
					csv += (parseInt(game) + 1) + ',' +		  // the game number
					       (parseInt(wave) + 1) + ',' +     // the wave number
					       settings[0] + ',' +		// the total num of creatures
								 settings[1] + ',' +		// the % targets
								 settings[2] + ',' +		// the uniformity
								 waves[wave].successRate + '\n';
				}
			}
			console.log(csv);
			saveAs(new Blob([csv], {type: 'txt.plain'}), id + '.csv');
		});
	}
	</script>
</body>
</html>
